# Rust + Tauri 桌面应用：集成代码编辑器、AI 聊天助手、CLI 输出与终端功能

## 需求：代码编辑器与设置管理应用

### 应用概述
一个集成了代码编辑、AI 助手聊天、CLI 日志输出和终端功能的桌面应用，支持多工作区管理和配置自定义。

### 界面设计

#### 1. 编辑器主界面
**布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ 菜单栏 (File Edit View Tools Help)                          │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│              │              编辑器区域                      │
│              │              (可编辑文件内容)                │
│  目录导航    │                                              │
│  (左侧)      │                                              │
│              ├──────────────────────────────────────────────┤
│              │              底部 Tab 区域                   │
│              │   ┌──────┬──────┬──────┬──────┐             │
│              │   │聊天  │输出  │终端  │...   │             │
│              │   └──────┴──────┴──────┴──────┘             │
│              │                                              │
└──────────────┴──────────────────────────────────────────────┘
```

**目录导航 (左侧)**：
- 树形结构显示文件系统
- 右键菜单选项：
  - 新建文件/文件夹
  - 重命名
  - 删除
  - 复制路径
  - 在终端中打开
  - 刷新
- 支持拖拽文件/文件夹
- 支持文件搜索过滤

**编辑器区域 (右侧)**：
- 基于 Monaco Editor 或 CodeMirror
- 支持语法高亮（多种编程语言）
- 支持代码折叠
- 支持查找/替换
- 支持多光标编辑
- 支持快捷键：
  - Ctrl+S：保存当前文件
  - Ctrl+Shift+S：保存所有打开的文件
- 右下角操作按钮：
  - 💾 保存当前文件
  - 💾💾 保存所有文件

**底部 Tab 区域**：

**Tab 1: 聊天输入界面**
```
┌─────────────────────────────────────────────────────────────┐
│ 关联按钮 [🔗] 已关联文件: file1.rs | file2.py | ...         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  多行文本输入框                                             │
│  (支持 Markdown 预览)                                       │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 请输入消息...                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│                    [清空]          [发送]                   │
├─────────────────────────────────────────────────────────────┤
│ 模型选择: [▽ Claude-3.5-Sonnet]                            │
│ Code CLI: [▽ OpenAI-Codex]                                 │
└─────────────────────────────────────────────────────────────┘
```
- **关联按钮**：点击后可以关联目录导航中的文件，被关联的文件在顶部右侧显示
- **输入框**：支持多行文本，Markdown 实时预览
- **操作按钮**：
  - 清空：清空聊天输入框
  - 发送：将文本发送到后端 AI 模型处理
- **底部操作栏**：
  - 模型选择下拉框：选择 AI 模型（Claude, GPT, Gemini 等）
  - Code CLI 选择下拉框：选择代码生成工具

**Tab 2: 输出界面**
```
┌─────────────────────────────────────────────────────────────┐
│ 搜索框: [____________] [🔍] [清空] [暂停/继续]              │
├─────────────────────────────────────────────────────────────┤
│ 2024-01-15 10:30:25 INFO  - 应用启动成功                    │
│ 2024-01-15 10:30:26 DEBUG - 加载配置文件: config.toml       │
│ 2024-01-15 10:30:27 INFO  - 数据库连接成功                  │
│ 2024-01-15 10:30:28 ERROR - 文件读取失败: /path/to/file     │
│ ...                                                         │
└─────────────────────────────────────────────────────────────┘
```
- 实时显示 CLI 日志输出
- 支持上下滚动查看历史日志
- 搜索功能：可搜索日志内容
- 控制按钮：
  - 清空：清空所有日志
  - 暂停/继续：暂停或继续日志输出

**Tab 3: 终端界面**
```
┌─────────────────────────────────────────────────────────────┐
│ 终端1 [×] 终端2 [×] 新建 [+]                                │
├─────────────────────────────────────────────────────────────┤
│ user@host:~$ pwd                                            │
│ /home/user/projects                                         │
│ user@host:~$ ls -la                                         │
│ total 48                                                    │
│ drwxr-xr-x  5 user user  4096 Jan 15 10:30 .                │
│ drwxr-xr-x 18 user user  4096 Jan 15 09:15 ..               │
│ drwxr-xr-x  8 user user  4096 Jan 15 10:30 .git             │
│ -rw-r--r--  1 user user   351 Jan 15 10:30 .gitignore       │
│ drwxr-xr-x  2 user user  4096 Jan 15 10:30 src              │
│ drwxr-xr-x  2 user user  4096 Jan 15 10:30 tests            │
│ user@host:~$ █                                              │
└─────────────────────────────────────────────────────────────┘
```
- 嵌入系统终端（xterm.js）
- 支持多标签页终端
- 支持常用终端操作
- 支持复制/粘贴
- 支持调整字体大小

#### 2. 设置界面
**布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ 设置                                                         │
├─────────────────────────────────────────────────────────────┤
│ 工作区设置                                                   │
│  当前工作区: [▽ 工作区1] [切换] [新建] [删除]               │
│                                                             │
│ 应用数据目录                                                 │
│  当前目录: /home/user/.app-data                             │
│  [浏览...] [重置为默认]                                     │
│                                                             │
│ CLI 工具路径设置                                             │
│  Node.js: [/usr/bin/node] [浏览...]                         │
│  Python: [/usr/bin/python3] [浏览...]                       │
│  Git: [/usr/bin/git] [浏览...]                              │
│                                                             │
│ 环境变量设置                                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 变量名        变量值                             操作│   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ API_KEY      sk-...****************               ✏️🗑️│   │
│  │ PATH         /usr/local/bin:/usr/bin:/bin          ✏️🗑️│   │
│  └─────────────────────────────────────────────────────┘   │
│  [添加环境变量]                                            │
│                                                             │
│ 模型管理                                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 模型名称        API端点             API密钥       操作│   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ Claude-3.5   api.anthropic.com/v1  ********       ✏️🗑️│   │
│  │ GPT-4        api.openai.com/v1     ********       ✏️🗑️│   │
│  └─────────────────────────────────────────────────────┘   │
│  [添加模型]                                               │
│                                                             │
│ Code CLI 管理                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ CLI名称        命令路径            参数           操作│   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ OpenAI-Codex  /usr/bin/codex      --model gpt-4  ✏️🗑️│   │
│  │ Local-Coder   /usr/local/bin/coder --local        ✏️🗑️│   │
│  └─────────────────────────────────────────────────────┘   │
│  [添加 Code CLI]                                          │
│                                                             │
│                    [保存] [取消] [恢复默认]                 │
└─────────────────────────────────────────────────────────────┘
```

**设置项详情**：
1. **工作区切换**：
   - 下拉选择工作区
   - 支持新建、删除工作区
   - 每个工作区独立配置和数据

2. **应用数据目录切换**：
   - 显示当前数据目录
   - 支持浏览选择新目录
   - 支持重置为默认目录

3. **CLI 工具路径设置**：
   - 常用开发工具路径配置
   - 支持浏览选择
   - 支持路径验证

4. **环境变量设置**：
   - 应用启动时临时设置
   - 应用关闭时自动清除
   - 支持增删改环境变量
   - 敏感信息（API密钥）显示为掩码

5. **模型列表管理**：
   - 支持增删改 AI 模型配置
   - 包含模型名称、API端点、API密钥
   - API密钥加密存储

6. **Code CLI 列表管理**：
   - 支持增删改代码生成工具配置
   - 包含 CLI 名称、命令路径、参数
   - 支持命令验证