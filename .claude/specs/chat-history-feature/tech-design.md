# æŠ€æœ¯æ–¹æ¡ˆï¼šèŠå¤©å†å²è®°å½•ç®¡ç†

ç”Ÿæˆæ—¶é—´ï¼š2025-12-21
åŸºäºPRDï¼šrequirements.md

## æ–‡ä»¶è§„åˆ’

### æ–°å»ºæ–‡ä»¶

#### 1. `src-tauri/src/services/chat_session.rs`
- èŒè´£ï¼šä¼šè¯ç®¡ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- ç±»å‹ï¼šæœåŠ¡å±‚æ¨¡å—
- è¯´æ˜ï¼šå®ç°ä¼šè¯çš„ä¿å­˜ã€åŠ è½½ã€åˆ é™¤ã€æ›´æ–°ç­‰æ“ä½œ

#### 2. `src-tauri/src/database/models/chat_session.rs`
- èŒè´£ï¼šä¼šè¯æ•°æ®æ¨¡å‹å®šä¹‰
- ç±»å‹ï¼šæ•°æ®æ¨¡å‹
- è¯´æ˜ï¼šå®šä¹‰ä¼šè¯æ•°æ®åº“è¡¨ç»“æ„å’ŒRustç»“æ„ä½“

#### 3. `src-tauri/src/database/repositories/chat_session_repository.rs`
- èŒè´£ï¼šä¼šè¯æ•°æ®åº“æ“ä½œä»“å‚¨å±‚
- ç±»å‹ï¼šæ•°æ®è®¿é—®å±‚
- è¯´æ˜ï¼šå®ç°ä¼šè¯çš„CRUDæ•°æ®åº“æ“ä½œ

#### 4. `src-tauri/src/migration/m20251221_create_chat_sessions_table.rs`
- èŒè´£ï¼šæ•°æ®åº“è¿ç§»æ–‡ä»¶
- ç±»å‹ï¼šæ•°æ®åº“è¿ç§»
- è¯´æ˜ï¼šåˆ›å»ºchat_sessionsè¡¨

#### 5. `src-tauri/src/tauri/chat_session_commands.rs`
- èŒè´£ï¼šTauri IPCå‘½ä»¤å®šä¹‰
- ç±»å‹ï¼šå‘½ä»¤å¤„ç†å™¨
- è¯´æ˜ï¼šå®šä¹‰å‰ç«¯å¯è°ƒç”¨çš„èŠå¤©ä¼šè¯ç›¸å…³å‘½ä»¤

#### 6. `frontend/src/components/chat/ChatHistoryDialog.vue`
- èŒè´£ï¼šå†å²è®°å½•å¯¹è¯æ¡†UIç»„ä»¶
- ç±»å‹ï¼šVueç»„ä»¶
- è¯´æ˜ï¼šå±•ç¤ºå†å²ä¼šè¯åˆ—è¡¨ï¼Œæä¾›æœç´¢ã€é¢„è§ˆã€åŠ è½½ã€åˆ é™¤ã€é‡å‘½åç­‰åŠŸèƒ½

### ä¿®æ”¹æ–‡ä»¶

#### 1. `frontend/src/components/chat/ChatPanel.vue`
- æ”¹åŠ¨ç±»å‹ï¼šæ–°å¢åŠŸèƒ½
- æ”¹åŠ¨è¯´æ˜ï¼š
  - æ·»åŠ å†å²è®°å½•å›¾æ ‡æŒ‰é’®ï¼ˆå·¥å…·æ ï¼‰
  - å®ç°ä¼šè¯è‡ªåŠ¨ä¿å­˜é€»è¾‘ï¼ˆå‘é€æ¶ˆæ¯åï¼‰
  - æ·»åŠ åŠ è½½å†å²ä¼šè¯åŠŸèƒ½
  - ç®¡ç†å½“å‰ä¼šè¯ID

#### 2. `frontend/src/services/tauri/commands.ts`
- æ”¹åŠ¨ç±»å‹ï¼šæ–°å¢å‘½ä»¤
- æ”¹åŠ¨è¯´æ˜ï¼šæ·»åŠ 4ä¸ªæ–°çš„Tauriå‘½ä»¤è°ƒç”¨å‡½æ•°ï¼š
  - `saveChatSession()` - ä¿å­˜ä¼šè¯
  - `loadChatSessions()` - åŠ è½½ä¼šè¯åˆ—è¡¨
  - `deleteChatSession()` - åˆ é™¤ä¼šè¯
  - `updateChatSessionName()` - æ›´æ–°ä¼šè¯åç§°

#### 3. `frontend/src/utils/types/index.ts`
- æ”¹åŠ¨ç±»å‹ï¼šæ–°å¢ç±»å‹
- æ”¹åŠ¨è¯´æ˜ï¼šæ·»åŠ `ChatSession`æ¥å£å®šä¹‰

#### 4. `src-tauri/src/main.rs`
- æ”¹åŠ¨ç±»å‹ï¼šæ³¨å†Œå‘½ä»¤
- æ”¹åŠ¨è¯´æ˜ï¼šåœ¨`invoke_handler`ä¸­æ³¨å†Œ4ä¸ªæ–°å‘½ä»¤

#### 5. `src-tauri/src/services/mod.rs`
- æ”¹åŠ¨ç±»å‹ï¼šå¯¼å‡ºæ¨¡å—
- æ”¹åŠ¨è¯´æ˜ï¼šæ·»åŠ `pub mod chat_session;`

#### 6. `src-tauri/src/database/models/mod.rs`
- æ”¹åŠ¨ç±»å‹ï¼šå¯¼å‡ºæ¨¡å—
- æ”¹åŠ¨è¯´æ˜ï¼šæ·»åŠ `pub mod chat_session;`

#### 7. `src-tauri/src/database/repositories/mod.rs`
- æ”¹åŠ¨ç±»å‹ï¼šå¯¼å‡ºæ¨¡å—
- æ”¹åŠ¨è¯´æ˜ï¼šæ·»åŠ `pub mod chat_session_repository;`

#### 8. `src-tauri/src/migration/mod.rs`
- æ”¹åŠ¨ç±»å‹ï¼šæ–°å¢è¿ç§»
- æ”¹åŠ¨è¯´æ˜ï¼šæ·»åŠ è¿ç§»æ–‡ä»¶å¼•ç”¨

## æ ¸å¿ƒæ¥å£å®šä¹‰

### å‰ç«¯ç±»å‹å®šä¹‰ï¼ˆTypeScriptï¼‰

#### ChatSession æ¥å£
```typescript
export interface ChatSession {
  id: string;                    // UUID
  name?: string;                 // è‡ªå®šä¹‰åç§°/å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
  messages: ChatMessage[];       // æ¶ˆæ¯åˆ—è¡¨
  createdAt: string;             // ISO 8601æ ¼å¼
  updatedAt: string;             // ISO 8601æ ¼å¼
  messageCount: number;          // æ¶ˆæ¯æ•°é‡
  firstMessagePreview: string;   // é¦–æ¡æ¶ˆæ¯é¢„è§ˆï¼ˆå‰100å­—ç¬¦ï¼‰
}
```

### åç«¯æ•°æ®æ¨¡å‹ï¼ˆRustï¼‰

#### ChatSession ç»“æ„ä½“
```rust
use serde::{Deserialize, Serialize};
use chrono::{DateTime, Utc};

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ChatSession {
    pub id: String,
    pub name: Option<String>,
    pub messages_json: String,  // JSONåºåˆ—åŒ–çš„æ¶ˆæ¯åˆ—è¡¨
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
    pub message_count: i32,
    pub first_message_preview: String,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ChatMessage {
    pub id: String,
    pub role: String,           // "user" | "assistant" | "system"
    pub content: String,
    pub timestamp: String,
    pub files: Option<Vec<String>>,
    pub model: Option<String>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct CreateChatSessionDto {
    pub name: Option<String>,
    pub messages: Vec<ChatMessage>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct UpdateChatSessionNameDto {
    pub id: String,
    pub name: String,
}
```

### æ•°æ®åº“è¡¨ç»“æ„ï¼ˆSQLiteï¼‰

```sql
CREATE TABLE IF NOT EXISTS chat_sessions (
    id TEXT PRIMARY KEY NOT NULL,
    name TEXT,
    messages_json TEXT NOT NULL,
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL,
    message_count INTEGER NOT NULL DEFAULT 0,
    first_message_preview TEXT NOT NULL DEFAULT ''
);

CREATE INDEX idx_chat_sessions_created_at ON chat_sessions(created_at DESC);
CREATE INDEX idx_chat_sessions_updated_at ON chat_sessions(updated_at DESC);
```

### Tauriå‘½ä»¤æ¥å£

#### 1. save_chat_session
```rust
#[tauri::command]
pub async fn save_chat_session(
    app: AppHandle,
    name: Option<String>,
    messages: Vec<ChatMessage>,
) -> Result<ChatSession, String>
```
- è¾“å…¥ï¼šä¼šè¯åç§°ï¼ˆå¯é€‰ï¼‰ã€æ¶ˆæ¯åˆ—è¡¨
- è¾“å‡ºï¼šä¿å­˜åçš„å®Œæ•´ä¼šè¯å¯¹è±¡
- è¯´æ˜ï¼šå¦‚æœä¼šè¯IDå·²å­˜åœ¨åˆ™æ›´æ–°ï¼Œå¦åˆ™åˆ›å»ºæ–°ä¼šè¯

#### 2. load_chat_sessions
```rust
#[tauri::command]
pub async fn load_chat_sessions(
    app: AppHandle,
    limit: Option<i32>,
    offset: Option<i32>,
) -> Result<Vec<ChatSession>, String>
```
- è¾“å…¥ï¼šåˆ†é¡µå‚æ•°ï¼ˆå¯é€‰ï¼‰
- è¾“å‡ºï¼šä¼šè¯åˆ—è¡¨ï¼ˆæŒ‰æ›´æ–°æ—¶é—´å€’åºï¼‰
- è¯´æ˜ï¼šæ”¯æŒåˆ†é¡µåŠ è½½ï¼Œé»˜è®¤è¿”å›æœ€è¿‘50ä¸ªä¼šè¯

#### 3. delete_chat_session
```rust
#[tauri::command]
pub async fn delete_chat_session(
    app: AppHandle,
    session_id: String,
) -> Result<(), String>
```
- è¾“å…¥ï¼šä¼šè¯ID
- è¾“å‡ºï¼šæ— ï¼ˆæˆåŠŸåˆ™è¿”å›Okï¼‰
- è¯´æ˜ï¼šæ°¸ä¹…åˆ é™¤æŒ‡å®šä¼šè¯

#### 4. update_chat_session_name
```rust
#[tauri::command]
pub async fn update_chat_session_name(
    app: AppHandle,
    session_id: String,
    name: String,
) -> Result<ChatSession, String>
```
- è¾“å…¥ï¼šä¼šè¯IDã€æ–°åç§°
- è¾“å‡ºï¼šæ›´æ–°åçš„ä¼šè¯å¯¹è±¡
- è¯´æ˜ï¼šä»…æ›´æ–°ä¼šè¯åç§°ï¼Œä¸ä¿®æ”¹æ¶ˆæ¯å†…å®¹

## æ•°æ®æµè®¾è®¡

### ä¿å­˜ä¼šè¯æµç¨‹
```
1. ç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ ChatPanel.sendMessage()
2. æ¶ˆæ¯æˆåŠŸå‘é€å â†’ è§¦å‘è‡ªåŠ¨ä¿å­˜
3. è°ƒç”¨ saveChatSession(currentSessionId, messages)
4. åç«¯æ¥æ”¶ â†’ chat_session_repository.upsert()
5. æ•°æ®åº“å†™å…¥ â†’ è¿”å›ä¼šè¯å¯¹è±¡
6. å‰ç«¯æ›´æ–° currentSessionIdï¼ˆå¦‚æœæ˜¯æ–°ä¼šè¯ï¼‰
```

### åŠ è½½ä¼šè¯åˆ—è¡¨æµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»å†å²å›¾æ ‡ â†’ æ‰“å¼€ ChatHistoryDialog
2. ç»„ä»¶æŒ‚è½½ â†’ è°ƒç”¨ loadChatSessions()
3. åç«¯æŸ¥è¯¢ â†’ chat_session_repository.find_all()
4. æ•°æ®åº“è¯»å– â†’ è¿”å›ä¼šè¯åˆ—è¡¨
5. å‰ç«¯æ¸²æŸ“åˆ—è¡¨ï¼ˆåŒ…å«æœç´¢ã€æ’åºåŠŸèƒ½ï¼‰
```

### åŠ è½½å•ä¸ªä¼šè¯æµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»æŸä¸ªå†å²ä¼šè¯ â†’ è§¦å‘é¢„è§ˆ
2. åœ¨å¯¹è¯æ¡†ä¸­å±•ç¤ºè¯¥ä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯
3. ç”¨æˆ·ç‚¹å‡»"åŠ è½½ä¼šè¯"æŒ‰é’®
4. å°†è¯¥ä¼šè¯çš„messagesèµ‹å€¼ç»™ChatPanel.messages
5. å…³é—­å¯¹è¯æ¡†ï¼Œç”¨æˆ·å¯ç»§ç»­å¯¹è¯
6. ç»§ç»­å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°è¯¥ä¼šè¯ï¼ˆéæ–°å»ºï¼‰
```

### æœç´¢è¿‡æ»¤æµç¨‹
```
1. ç”¨æˆ·è¾“å…¥æœç´¢å…³é”®è¯ â†’ searchQuery
2. å‰ç«¯è¿‡æ»¤ä¼šè¯åˆ—è¡¨ï¼š
   - åŒ¹é…ä¼šè¯åç§°ï¼ˆnameå­—æ®µï¼‰
   - åŒ¹é…é¦–æ¡æ¶ˆæ¯é¢„è§ˆï¼ˆfirstMessagePreviewå­—æ®µï¼‰
3. å®æ—¶æ›´æ–°æ˜¾ç¤ºç»“æœï¼ˆcomputedå±æ€§ï¼‰
```

## é›†æˆç‚¹

### ä¸ç°æœ‰ChatPanelé›†æˆ
- **å·¥å…·æ æŒ‰é’®**ï¼šåœ¨æ¸…ç©ºèŠå¤©æŒ‰é’®æ—è¾¹æ·»åŠ å†å²å›¾æ ‡ï¼ˆä½¿ç”¨`@element-plus/icons-vue`çš„`Clock`å›¾æ ‡ï¼‰
- **è‡ªåŠ¨ä¿å­˜æ—¶æœº**ï¼šåœ¨`sendMessage()`å‡½æ•°æˆåŠŸå‘é€åè°ƒç”¨`autoSaveChatSession()`
- **ä¼šè¯IDç®¡ç†**ï¼šæ·»åŠ `currentSessionId` refå˜é‡ï¼Œç”¨äºè·Ÿè¸ªå½“å‰ä¼šè¯

### ä¸ç°æœ‰æ•°æ®åº“é›†æˆ
- ä½¿ç”¨ç°æœ‰çš„`database/connection.rs`è·å–æ•°æ®åº“è¿æ¥
- éµå¾ªç°æœ‰çš„Repositoryæ¨¡å¼ï¼ˆå‚è€ƒ`workspace_repository.rs`ï¼‰
- ä½¿ç”¨ç°æœ‰çš„Migrationæœºåˆ¶ï¼ˆsea-orm-migrationï¼‰

### ä¸ç°æœ‰Tauriå‘½ä»¤é›†æˆ
- åœ¨`main.rs`çš„`invoke_handler`ä¸­æ³¨å†Œæ–°å‘½ä»¤
- åœ¨`tauri/mod.rs`ä¸­å¯¼å‡ºæ–°çš„å‘½ä»¤æ¨¡å—
- åœ¨`services/mod.rs`ä¸­å¯¼å‡ºæ–°çš„æœåŠ¡æ¨¡å—

## å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¿ç§»å’Œæ¨¡å‹ï¼ˆé¢„ä¼°ï¼š15åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - åˆ›å»ºè¿ç§»æ–‡ä»¶ `m20251221_create_chat_sessions_table.rs`
  - åˆ›å»ºæ•°æ®æ¨¡å‹ `database/models/chat_session.rs`
  - åœ¨`mod.rs`ä¸­æ³¨å†Œæ¨¡å—
- äº§å‡ºï¼š
  - `src-tauri/src/migration/m20251221_*_create_chat_sessions_table.rs`
  - `src-tauri/src/database/models/chat_session.rs`

### æ­¥éª¤2ï¼šå®ç°æ•°æ®è®¿é—®å±‚ï¼ˆé¢„ä¼°ï¼š20åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - åˆ›å»º`chat_session_repository.rs`
  - å®ç°CRUDæ–¹æ³•ï¼šcreate, find_all, find_by_id, update, delete
  - æ·»åŠ æœç´¢å’Œåˆ†é¡µæ”¯æŒ
- äº§å‡ºï¼š
  - `src-tauri/src/database/repositories/chat_session_repository.rs`

### æ­¥éª¤3ï¼šå®ç°æœåŠ¡å±‚å’ŒTauriå‘½ä»¤ï¼ˆé¢„ä¼°ï¼š25åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - åˆ›å»º`services/chat_session.rs`ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
  - åˆ›å»º`tauri/chat_session_commands.rs`ï¼ˆå‘½ä»¤å¤„ç†å™¨ï¼‰
  - åœ¨`main.rs`ä¸­æ³¨å†Œ4ä¸ªå‘½ä»¤
- äº§å‡ºï¼š
  - `src-tauri/src/services/chat_session.rs`
  - `src-tauri/src/tauri/chat_session_commands.rs`
  - ä¿®æ”¹ `src-tauri/src/main.rs`

### æ­¥éª¤4ï¼šæ·»åŠ å‰ç«¯ç±»å‹å’Œå‘½ä»¤è°ƒç”¨ï¼ˆé¢„ä¼°ï¼š10åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - åœ¨`types/index.ts`æ·»åŠ `ChatSession`æ¥å£
  - åœ¨`commands.ts`æ·»åŠ 4ä¸ªå‘½ä»¤è°ƒç”¨å‡½æ•°
- äº§å‡ºï¼š
  - ä¿®æ”¹ `frontend/src/utils/types/index.ts`
  - ä¿®æ”¹ `frontend/src/services/tauri/commands.ts`

### æ­¥éª¤5ï¼šå®ç°ChatHistoryDialogç»„ä»¶ï¼ˆé¢„ä¼°ï¼š40åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - åˆ›å»ºç»„ä»¶éª¨æ¶ï¼ˆElDialog + åˆ—è¡¨å¸ƒå±€ï¼‰
  - å®ç°ä¼šè¯åˆ—è¡¨å±•ç¤ºï¼ˆæ—¶é—´ã€æ¶ˆæ¯æ•°ã€é¢„è§ˆï¼‰
  - å®ç°æœç´¢è¿‡æ»¤åŠŸèƒ½
  - å®ç°é¢„è§ˆé¢æ¿ï¼ˆç‚¹å‡»å±•å¼€æ˜¾ç¤ºå®Œæ•´æ¶ˆæ¯ï¼‰
  - å®ç°åˆ é™¤åŠŸèƒ½ï¼ˆå¸¦ç¡®è®¤æç¤ºï¼‰
  - å®ç°é‡å‘½ååŠŸèƒ½ï¼ˆElDialogåµŒå¥—æˆ–inlineç¼–è¾‘ï¼‰
  - å®ç°åŠ è½½ä¼šè¯åŠŸèƒ½ï¼ˆemitäº‹ä»¶æˆ–å›è°ƒï¼‰
- äº§å‡ºï¼š
  - `frontend/src/components/chat/ChatHistoryDialog.vue`

### æ­¥éª¤6ï¼šä¿®æ”¹ChatPanelé›†æˆå†å²åŠŸèƒ½ï¼ˆé¢„ä¼°ï¼š20åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - å¯¼å…¥`Clock`å›¾æ ‡å’Œ`ChatHistoryDialog`ç»„ä»¶
  - æ·»åŠ å†å²æŒ‰é’®åˆ°å·¥å…·æ 
  - æ·»åŠ `showHistoryDialog` refå˜é‡
  - æ·»åŠ `currentSessionId` refå˜é‡ï¼ˆç”¨äºè·Ÿè¸ªå½“å‰ä¼šè¯ï¼‰
  - å®ç°`autoSaveChatSession()`å‡½æ•°ï¼ˆåœ¨sendMessageæˆåŠŸåè°ƒç”¨ï¼‰
  - å®ç°`loadHistorySession(session)`å‡½æ•°ï¼ˆåŠ è½½é€‰ä¸­çš„ä¼šè¯ï¼‰
  - æ·»åŠ å¯¹è¯æ¡†ç»„ä»¶åˆ°template
- äº§å‡ºï¼š
  - ä¿®æ”¹ `frontend/src/components/chat/ChatPanel.vue`

### æ­¥éª¤7ï¼šæµ‹è¯•å’Œè°ƒè¯•ï¼ˆé¢„ä¼°ï¼š20åˆ†é’Ÿï¼‰
- ä»»åŠ¡ï¼š
  - æµ‹è¯•ä¼šè¯è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
  - æµ‹è¯•å†å²åˆ—è¡¨åŠ è½½å’Œå±•ç¤º
  - æµ‹è¯•æœç´¢è¿‡æ»¤åŠŸèƒ½
  - æµ‹è¯•åˆ é™¤ä¼šè¯åŠŸèƒ½
  - æµ‹è¯•é‡å‘½ååŠŸèƒ½
  - æµ‹è¯•åŠ è½½å†å²ä¼šè¯åˆ°å½“å‰é¢æ¿
  - ä¿®å¤å‘ç°çš„bug
- äº§å‡ºï¼š
  - åŠŸèƒ½éªŒè¯æŠ¥å‘Š

## æŠ€æœ¯å†³ç­–

### å†³ç­–1ï¼šä½¿ç”¨SQLiteæ•°æ®åº“è€ŒéJSONæ–‡ä»¶
- åŸå› ï¼š
  - é¡¹ç›®å·²æœ‰SQLiteæ•°æ®åº“å’ŒMigrationæœºåˆ¶
  - æ•°æ®åº“æ”¯æŒæ›´å¥½çš„æŸ¥è¯¢æ€§èƒ½ï¼ˆæœç´¢ã€åˆ†é¡µï¼‰
  - æ›´å®¹æ˜“æ‰©å±•ï¼ˆæœªæ¥å¯æ·»åŠ ç´¢å¼•ã€å…³è”æŸ¥è¯¢ï¼‰
  - äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®ä¸€è‡´æ€§æ›´å¥½

### å†³ç­–2ï¼šæ¶ˆæ¯åˆ—è¡¨å­˜å‚¨ä¸ºJSONå­—ç¬¦ä¸²
- åŸå› ï¼š
  - æ¶ˆæ¯æ˜¯ä¼šè¯çš„å®Œæ•´å¿«ç…§ï¼Œä¸éœ€è¦å•ç‹¬æŸ¥è¯¢
  - é¿å…åˆ›å»ºé¢å¤–çš„messagesè¡¨å’Œå¤–é”®å…³è”
  - ç®€åŒ–æ•°æ®æ¨¡å‹ï¼Œæé«˜è¯»å–æ€§èƒ½
  - messagesç»“æ„ç›¸å¯¹å›ºå®šï¼ŒJSONåºåˆ—åŒ–æˆæœ¬ä½

### å†³ç­–3ï¼šå‰ç«¯é¢„è§ˆä½¿ç”¨å†…å­˜ç¼“å­˜ï¼Œä¸è¯·æ±‚å•ç‹¬æ¥å£
- åŸå› ï¼š
  - `load_chat_sessions`å·²è¿”å›å®Œæ•´æ¶ˆæ¯åˆ—è¡¨
  - å‡å°‘ç½‘ç»œè¯·æ±‚ï¼Œæå‡å“åº”é€Ÿåº¦
  - ä¼šè¯åˆ—è¡¨é€šå¸¸ä¸ä¼šå¾ˆå¤§ï¼ˆé™åˆ¶50ä¸ªï¼‰ï¼Œå†…å­˜æ¶ˆè€—å¯æ§

### å†³ç­–4ï¼šè‡ªåŠ¨ä¿å­˜é‡‡ç”¨"upsert"æ¨¡å¼
- åŸå› ï¼š
  - é¦–æ¬¡ä¿å­˜åˆ›å»ºæ–°ä¼šè¯ï¼Œåç»­ä¿å­˜æ›´æ–°ç°æœ‰ä¼šè¯
  - ç”¨æˆ·æ— éœ€æ‰‹åŠ¨åˆ›å»ºä¼šè¯ï¼Œä½“éªŒæ›´æµç•…
  - é€šè¿‡`currentSessionId`åˆ¤æ–­æ˜¯æ–°å»ºè¿˜æ˜¯æ›´æ–°

### å†³ç­–5ï¼šä½¿ç”¨ElDialogåµŒå¥—è€Œéè·¯ç”±è·³è½¬
- åŸå› ï¼š
  - ä¿æŒåœ¨èŠå¤©é¡µé¢ä¸Šä¸‹æ–‡ï¼Œä¸ä¸­æ–­ç”¨æˆ·æµç¨‹
  - ä¸ç°æœ‰"å…³è”æ–‡ä»¶"å¼¹çª—ä¿æŒä¸€è‡´çš„äº¤äº’æ¨¡å¼
  - å®ç°ç®€å•ï¼Œä»£ç å¤ç”¨åº¦é«˜

## é£é™©ç‚¹

### é£é™©1ï¼šå¤§é‡å†å²ä¼šè¯å¯¼è‡´æ€§èƒ½é—®é¢˜
- è¯´æ˜ï¼šå¦‚æœç”¨æˆ·ç§¯ç´¯äº†æ•°ç™¾ä¸ªä¼šè¯ï¼Œåˆ—è¡¨åŠ è½½å¯èƒ½å˜æ…¢
- åº”å¯¹æªæ–½ï¼š
  - å®ç°åˆ†é¡µåŠ è½½ï¼ˆé»˜è®¤50ä¸ªï¼Œæ»šåŠ¨åŠ è½½æ›´å¤šï¼‰
  - æ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼ˆcreated_at, updated_atï¼‰
  - å‰ç«¯ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚element-plusçš„ElVirtualListï¼Œå¦‚éœ€è¦ï¼‰

### é£é™©2ï¼šæ¶ˆæ¯å†…å®¹è¿‡å¤§å¯¼è‡´æ•°æ®åº“è†¨èƒ€
- è¯´æ˜ï¼šé•¿å¯¹è¯å¯èƒ½äº§ç”ŸMBçº§åˆ«çš„JSONæ•°æ®
- åº”å¯¹æªæ–½ï¼š
  - é™åˆ¶å•ä¸ªä¼šè¯æœ€å¤§æ¶ˆæ¯æ•°ï¼ˆå¦‚1000æ¡ï¼‰
  - å®ç°è‡ªåŠ¨å½’æ¡£æˆ–æ¸…ç†æ—§ä¼šè¯åŠŸèƒ½ï¼ˆæœªæ¥æ‰©å±•ï¼‰
  - åœ¨ä¿å­˜æ—¶å‹ç¼©æ¶ˆæ¯å†…å®¹ï¼ˆå¯é€‰ï¼‰

### é£é™©3ï¼šå¹¶å‘ä¿å­˜å¯¼è‡´æ•°æ®å†²çª
- è¯´æ˜ï¼šå¿«é€Ÿè¿ç»­å‘é€å¤šæ¡æ¶ˆæ¯æ—¶ï¼Œå¯èƒ½åŒæ—¶è§¦å‘å¤šæ¬¡ä¿å­˜
- åº”å¯¹æªæ–½ï¼š
  - ä½¿ç”¨é˜²æŠ–ï¼ˆdebounceï¼‰å»¶è¿Ÿä¿å­˜æ“ä½œ
  - ä¿å­˜å‰æ£€æŸ¥ä¼šè¯æ˜¯å¦å·²è¢«æ›´æ–°
  - æ•°æ®åº“äº‹åŠ¡ä¿è¯åŸå­æ€§

### é£é™©4ï¼šè¿ç§»å¤±è´¥å¯¼è‡´åº”ç”¨å¯åŠ¨å¤±è´¥
- è¯´æ˜ï¼šæ•°æ®åº“è¿ç§»å‡ºé”™å¯èƒ½é˜»å¡åº”ç”¨å¯åŠ¨
- åº”å¯¹æªæ–½ï¼š
  - å……åˆ†æµ‹è¯•è¿ç§»æ–‡ä»¶
  - æä¾›å›æ»šæœºåˆ¶ï¼ˆsea-orm-migrationæ”¯æŒï¼‰
  - è¿ç§»å¤±è´¥æ—¶è®°å½•è¯¦ç»†æ—¥å¿—

## UI/UX è®¾è®¡è¦ç‚¹

### ChatPanelå·¥å…·æ å¸ƒå±€
```
[æ¨¡å‹é€‰æ‹©]  [Code CLIé€‰æ‹©]  [å†å²è®°å½•å›¾æ ‡ğŸ•’]  [å…³è”æ–‡ä»¶ğŸ“]  [æ¸…ç©ºèŠå¤©ğŸ—‘ï¸]
```

### ChatHistoryDialogå¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠå¤©å†å²                                    [æœç´¢æ¡†ğŸ”]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¼šè¯åˆ—è¡¨ (å·¦ä¾§)     â”‚ é¢„è§ˆé¢æ¿ (å³ä¾§)                   â”‚
â”‚                     â”‚                                   â”‚
â”‚ â–¡ è®¨è®ºVueæ¶æ„       â”‚ [ä¼šè¯åç§°: è®¨è®ºVueæ¶æ„]           â”‚
â”‚   10æ¡æ¶ˆæ¯          â”‚                                   â”‚
â”‚   2025-12-20 14:30  â”‚ User: ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£Vue 3çš„...  â”‚
â”‚                     â”‚                                   â”‚
â”‚ â–¡ Pythonçˆ¬è™«å¼€å‘    â”‚ Assistant: å¾ˆé«˜å…´å¸®åŠ©ä½ ...       â”‚
â”‚   25æ¡æ¶ˆæ¯          â”‚                                   â”‚
â”‚   2025-12-19 09:15  â”‚ User: ç»§ç»­åˆšæ‰çš„è¯é¢˜...          â”‚
â”‚                     â”‚                                   â”‚
â”‚ [åŠ è½½æ›´å¤š...]       â”‚ [åŠ è½½ä¼šè¯] [é‡å‘½å] [åˆ é™¤]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’ç»†èŠ‚
1. **æœç´¢å®æ—¶è¿‡æ»¤**ï¼šè¾“å…¥æ—¶ç«‹å³æ›´æ–°åˆ—è¡¨
2. **ç‚¹å‡»ä¼šè¯æ˜¾ç¤ºé¢„è§ˆ**ï¼šå³ä¾§é¢æ¿æ»šåŠ¨æ˜¾ç¤ºæ‰€æœ‰æ¶ˆæ¯
3. **åŒå‡»ä¼šè¯ç›´æ¥åŠ è½½**ï¼šå¿«æ·æ“ä½œ
4. **åˆ é™¤ç¡®è®¤æç¤º**ï¼š`ElMessageBox.confirm()`
5. **é‡å‘½åinlineç¼–è¾‘**ï¼šç‚¹å‡»åç§°åŒºåŸŸå¯ç¼–è¾‘
6. **åŠ è½½æˆåŠŸæç¤º**ï¼š`ElMessage.success('å·²åŠ è½½ä¼šè¯')`

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ç´¢å¼•**ï¼šåœ¨created_atå’Œupdated_atå­—æ®µä¸Šåˆ›å»ºç´¢å¼•
2. **åˆ†é¡µåŠ è½½**ï¼šé»˜è®¤åŠ è½½50ä¸ªä¼šè¯ï¼Œæ”¯æŒæ»šåŠ¨åŠ è½½æ›´å¤š
3. **æœç´¢é˜²æŠ–**ï¼šæœç´¢è¾“å…¥ä½¿ç”¨300msé˜²æŠ–
4. **æ¶ˆæ¯é¢„è§ˆæˆªå–**ï¼šé¦–æ¡æ¶ˆæ¯ä»…å­˜å‚¨å‰100å­—ç¬¦ä½œä¸ºé¢„è§ˆ
5. **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¦‚ä¼šè¯æ•°é‡è¶…è¿‡100ï¼Œè€ƒè™‘ä½¿ç”¨ElVirtualList

## å®‰å…¨è€ƒè™‘

1. **è¾“å…¥éªŒè¯**ï¼šå‰ç«¯éªŒè¯ä¼šè¯åç§°é•¿åº¦ï¼ˆâ‰¤100å­—ç¬¦ï¼‰
2. **SQLæ³¨å…¥é˜²æŠ¤**ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆsea-ormè‡ªåŠ¨å¤„ç†ï¼‰
3. **XSSé˜²æŠ¤**ï¼šæ¶ˆæ¯å†…å®¹ä½¿ç”¨Vueçš„æ–‡æœ¬æ’å€¼ï¼ˆè‡ªåŠ¨è½¬ä¹‰ï¼‰
4. **æ–‡ä»¶è·¯å¾„éªŒè¯**ï¼šå…³è”æ–‡ä»¶è·¯å¾„éœ€éªŒè¯åˆæ³•æ€§ï¼ˆå·²æœ‰å®ç°ï¼‰

## æœªæ¥æ‰©å±•ç‚¹

1. **ä¼šè¯å¯¼å‡º**ï¼šå¯¼å‡ºä¸ºMarkdownæˆ–JSONæ–‡ä»¶
2. **ä¼šè¯æ ‡ç­¾**ï¼šä¸ºä¼šè¯æ·»åŠ æ ‡ç­¾åˆ†ç±»
3. **ä¼šè¯åˆ†äº«**ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥ï¼ˆéœ€åç«¯æ”¯æŒï¼‰
4. **ä¼šè¯å¤‡ä»½**ï¼šäº‘ç«¯åŒæ­¥æˆ–æœ¬åœ°å¤‡ä»½
5. **å…¨æ–‡æœç´¢**ï¼šä½¿ç”¨FTS5å…¨æ–‡æœç´¢å¼•æ“
6. **ä¼šè¯ç»Ÿè®¡**ï¼šåˆ†æå¯¹è¯è¶‹åŠ¿ã€å¸¸ç”¨æ¨¡å‹ç­‰
